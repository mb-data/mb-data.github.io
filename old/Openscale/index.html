
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Repositório com documentações e materiais da Khipo">
      
      
        <meta name="author" content="Arthur Olga, Filipe Borba">
      
      
        <link rel="canonical" href="https://mb-data.github.io/old/Openscale/">
      
      <link rel="icon" href="../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>Monitoring with IBM OpenScale - Khipo Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../ASCII_cinema/asciinema-player.css">
    
      <link rel="stylesheet" href="../../_css/extra_css.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="orange">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#monitoring-with-ibm-openscale" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Khipo Docs" class="md-header__button md-logo" aria-label="Khipo Docs" data-md-component="logo">
      
  <img src="https://khipo.com.br/wp-content/uploads/2019/09/khipologo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Khipo Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Monitoring with IBM OpenScale
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M9.598 1.591a.75.75 0 0 1 .785-.175 7 7 0 1 1-8.967 8.967.75.75 0 0 1 .961-.96 5.5 5.5 0 0 0 7.046-7.046.75.75 0 0 1 .175-.786zm1.616 1.945a7 7 0 0 1-7.678 7.678 5.5 5.5 0 1 0 7.678-7.678z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 10.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5zM8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0V.75A.75.75 0 0 1 8 0zm0 13a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 8 13zM2.343 2.343a.75.75 0 0 1 1.061 0l1.06 1.061a.75.75 0 0 1-1.06 1.06l-1.06-1.06a.75.75 0 0 1 0-1.06zm9.193 9.193a.75.75 0 0 1 1.06 0l1.061 1.06a.75.75 0 0 1-1.06 1.061l-1.061-1.06a.75.75 0 0 1 0-1.061zM16 8a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1 0-1.5h1.5A.75.75 0 0 1 16 8zM3 8a.75.75 0 0 1-.75.75H.75a.75.75 0 0 1 0-1.5h1.5A.75.75 0 0 1 3 8zm10.657-5.657a.75.75 0 0 1 0 1.061l-1.061 1.06a.75.75 0 1 1-1.06-1.06l1.06-1.06a.75.75 0 0 1 1.06 0zm-9.193 9.193a.75.75 0 0 1 0 1.06l-1.06 1.061a.75.75 0 1 1-1.061-1.06l1.06-1.061a.75.75 0 0 1 1.061 0z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mb-data/mb-data.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    khipo-docs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Khipo Docs" class="md-nav__button md-logo" aria-label="Khipo Docs" data-md-component="logo">
      
  <img src="https://khipo.com.br/wp-content/uploads/2019/09/khipologo.png" alt="logo">

    </a>
    Khipo Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mb-data/mb-data.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    khipo-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Testes de Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Testes de Software" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Testes de Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Testes/Vis%C3%A3o%20Geral/" class="md-nav__link">
        Visão Geral
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-up-the-environment" class="md-nav__link">
    Setting Up the Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    Logging
  </a>
  
    <nav class="md-nav" aria-label="Logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#we-can-also-access-and-generate-logs-via-the-python-api" class="md-nav__link">
    We can also access and generate Logs via the Python API
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluating-model" class="md-nav__link">
    Evaluating Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explaining-predictions" class="md-nav__link">
    Explaining Predictions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/mb-data/mb-data.github.io/tree/main/docs/old/Openscale/index.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="monitoring-with-ibm-openscale">Monitoring with IBM OpenScale</h1>
<h3 id="setting-up-the-environment">Setting Up the Environment</h3>
<ol>
<li>
<p>Creating OpenScale service from the <a href="https://cloud.ibm.com/catalog/services/watson-openscale">Services Catalog</a>
 <br />
<div style="text-align:center"><img src="../assets/Openscale/select-wos.png" alt="drawing" /></div>
</p>
</li>
<li>
<p>Creating Machine Learning Provider</p>
<p>On the Machine Learning  Provider Tab, click on the <code>Add machine learning provider</code> button.
<div style="text-align:center"><img src="../assets/Openscale/Capture2.PNG" alt="drawing" /></div></p>
<p>2.1 Add a name and description.</p>
<p><div style="text-align:center"><img src="../assets/Openscale/Capture3.PNG" alt="drawing" /></div></p>
<p>2.2 Add connections  and Select Deployment Space
Under <code>Service Provider</code>, select <code>Watson Machine Learning (V2)</code> from the dropdown. Next select the deployment space your model is located in.
<div style="text-align:center"><img src="../assets/Openscale/Capture4.PNG" alt="drawing" /></div></p>
</li>
<li>
<p>Adding to Dashboard
    3.1 On the <code>Insights Dashboard</code>, click on the <code>Add to dashboard</code> button.
    <div style="text-align:center"><img src="../assets/Openscale/Capture5.PNG" alt="drawing" /></div>
    3.2 Next select the provider you just created, then select your model deployment and click on <code>Configure</code> and then <code>Configure Monitors</code>.</p>
<p><div style="text-align:center"><img src="../assets/Openscale/Capture6.PNG" alt="drawing" /></div></p>
<p>3.3 Select the data and algorithm  types, in our example it is a Binary Classification.</p>
<p>3.4 The next step is selecting the training data that can be stored on a Db2 database or in IBM's Cloud Object Storage.</p>
<p><div style="text-align:center"><img src="../assets/Openscale/Capture7.PNG" alt="drawing" width=50%/></div></p>
<p>3.5 Now select the Label column (column you want to predict).</p>
<p>3.6 Next we select all the features we want to include as well as indicate which ones are categorical.
<div style="text-align:center"><img src="../assets/Openscale/Capture8.PNG" alt="drawing" width=50%/></div></p>
<p>3.7 Here we can select Automatic Logging.</p>
<p>3.8 Finally, we can select <code>prediction</code> and <code>probability</code> for the model output.</p>
</li>
<li>
<p>Configuring Monitors
    We can create monitors for <code>Fairness</code>,  <code>Quality</code>. <code>Drift</code> and <code>Explainability</code>.</p>
<p>4.1 <strong>Fairness:</strong> The monitor checks your deployments for biases. It tracks when the model shows a tendency to provide a favorable (preferable) outcome more often for one group over another. </p>
<p>We have to specify which values represent favorable outcomes and then select the features to monitor for bias, in our case we chose to monitor extreme temperatures in the <code>MinTemp</code> and <code>MaxTemp</code> columns.
 <div style="text-align:center"><img src="../assets/Openscale/Capture9.PNG" alt="drawing" width=50%/></div></p>
<p>4.2 <strong>Quality:</strong> This monitor evaluates how well the model predicts accurate outcomes that match labeled data. It identifies when model quality declines, so we can retrain your model if needed.</p>
<p>We can set the Quality Threshold value, which Area under ROC, at 0.8.</p>
<p>4.3 <strong>Drift:</strong> The drift evaluation measures drop in accuracy by estimating the drop in accuracy from a base accuracy score determined by the training data and also drops in data consistency, by estimating the drop in data consistency by comparing recent model transactions to the training data.</p>
<p>We can set the Drift threshold as 20%.</p>
<p>4.4 <strong>Explainability:</strong> This allows us to reveal which features contributed to the model’s predicted outcome for a transaction and suggests what changes would result in a different outcome.</p>
<p>We can set all features as controllable.</p>
</li>
</ol>
<h3 id="logging">Logging</h3>
<p>In the <code>Transactions</code> page, we can see informations about transactions, including a Timestamp, Prediction and Confidence.</p>
<div style="text-align:center"><img src="../assets/Openscale/Capture10.PNG" alt="drawing" width=100%/></div>

<h4 id="we-can-also-access-and-generate-logs-via-the-python-api">We can also access and generate Logs via the Python API</h4>
<ol>
<li>
<p>First we need to initialize  the Watson Machine Learning and OpenScale clients as well as the IAMAuthenticator.</p>
<div class="highlight"><pre><span></span><code>service_credentials = {
    &quot;apikey&quot;: credentials[&quot;apikey&quot;],
    &quot;url&quot;: &quot;https://api.aiopenscale.cloud.ibm.com&quot;,
}

DEPLOYMENT_UID = metadata[&quot;deployment_uid&quot;]
MODEL_UID = metadata[&quot;model_uid&quot;]
MODEL_NAME = metadata[&quot;project_name&quot;] + &quot;_&quot; + metadata[&quot;project_version&quot;]
SPACE_ID = credentials[&quot;space_id&quot;]
WOS_GUID = get_instance_guid(api_key=service_credentials[&quot;apikey&quot;])
WOS_CREDENTIALS = {
    &quot;instance_guid&quot;: WOS_GUID,
    &quot;apikey&quot;: service_credentials[&quot;apikey&quot;],
    &quot;url&quot;: &quot;https://api.aiopenscale.cloud.ibm.com&quot;,
}

if WOS_GUID is None:
    print(&quot;Watson OpenScale GUID NOT FOUND&quot;)
else:
    print(WOS_GUID)

wml_credentials = {&quot;url&quot;: credentials[&quot;url&quot;], &quot;apikey&quot;: credentials[&quot;apikey&quot;]}

wml_client = ibm_watson_machine_learning.APIClient(wml_credentials)

wml_credentials = {
    &quot;url&quot;: credentials[&quot;url&quot;],
    &quot;apikey&quot;: credentials[&quot;apikey&quot;],
    &quot;instance_id&quot;: &quot;wml_local&quot;,
}

wml_client.set.default_space(SPACE_ID)

authenticator = IAMAuthenticator(apikey=credentials[&quot;apikey&quot;])
wos_client = ibm_watson_openscale.APIClient(
    authenticator=authenticator, 
    service_url=&quot;https://api.aiopenscale.cloud.ibm.com&quot;)
</code></pre></div>
</li>
<li>
<p>Then we can get the model's scoring endpoint.</p>
<div class="highlight"><pre><span></span><code>for deployment in wml_client.deployments.get_details()[&#39;resources&#39;]:
    if DEPLOYMENT_UID in deployment[&#39;metadata&#39;][&#39;id&#39;]:

        scoring_endpoint = deployment[&#39;entity&#39;][&#39;status&#39;][&#39;online_url&#39;][&#39;url&#39;]

print(scoring_endpoint)

https://us-south.ml.cloud.ibm.com/ml/v4/deployments/e02e481d-4e56-470f-baa9-ae84a583c0a8/predictions
</code></pre></div>
</li>
<li>
<p>Here we display the OpenScale subscriptions.</p>
<div class="highlight"><pre><span></span><code>wos_client.subscriptions.show()
</code></pre></div>
</li>
<li>
<p>Now we can load a dataset and then create the request body to make the predictions.</p>
<div class="highlight"><pre><span></span><code>df_data = pd.read_csv(&quot;../data/weatherAUS_processed.csv&quot;)

X = df_data.iloc[:, :-1]
y = df_data[df_data.columns[-1]]
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.01, random_state=1337
)

payload_scoring = {
    &quot;input_data&quot;: [
        {
            &quot;fields&quot;: X.columns.to_numpy().tolist(),
            &quot;values&quot;: X_test.to_numpy().tolist(),
        }
    ]
}
</code></pre></div>
</li>
<li>
<p>Then we send the request to our model.</p>
<div class="highlight"><pre><span></span><code>scoring_response = wml_client.deployments.score(DEPLOYMENT_UID, payload_scoring)
</code></pre></div>
</li>
<li>
<p>After that, we use the <code>subscription_id</code> we got from step 3. we get the Payload data set ID.</p>
<div class="highlight"><pre><span></span><code>subscription_id = &#39;bb7a45c3-15ad-4932-aeb8-8d32d54b8b05&#39;

payload_data_set_id = wos_client.data_sets.list(type=DataSetTypes.PAYLOAD_LOGGING, target_target_id=subscription_id, target_target_type=TargetTypes.SUBSCRIPTION).result.data_sets[0].metadata.id

print(&quot;Payload data set id:&quot;, payload_data_set_id)

Payload data set id: f4791725-24f8-4a00-9c13-b331ebca47f6
</code></pre></div>
</li>
<li>
<p>Now we can manually create logs with the predictions from our model and the data we sent in the request.</p>
<div class="highlight"><pre><span></span><code>records = [PayloadRecord(request=payload_scoring, response=scoring_response, response_time=72)]
store_record_info = wos_client.data_sets.store_records(payload_data_set_id, records)
</code></pre></div>
</li>
<li>
<p>We also can do the same thing for <code>Feedback</code> datasets, which don't require the model prediction.</p>
<div class="highlight"><pre><span></span><code>feedback_dataset = wos_client.data_sets.list(type=DataSetTypes.FEEDBACK, 
                                        target_target_id=subscription_id, 
                                        target_target_type=TargetTypes.SUBSCRIPTION).result

feedback_dataset_id = feedback_dataset.data_sets[0].metadata.id
if feedback_dataset_id is None:
    print(&quot;Feedback data set not found. Please check quality monitor status.&quot;)
    sys.exit(1)

data = X_test.to_dict(&#39;records&#39;)

wos_client.data_sets.store_records(
    feedback_dataset_id, 
    request_body=data, 
    background_mode=False,
    header=True,
    delimiter=&#39;,&#39;,
    csv_max_line_length=1000)

print(wos_client.data_sets.get_records_count(data_set_id=feedback_dataset_id))
</code></pre></div>
</li>
<li>
<p>After that we can access these datasets as Pandas dataframes.</p>
<div class="highlight"><pre><span></span><code>records2 = wos_client.data_sets.get_list_of_records(data_set_id=payload_data_set_id,output_type=ResponseTypes.PANDAS)

df = records2.result
</code></pre></div>
</li>
<li>
<p>Then we can use that Pandas dataframe to create plots or other forms of analysis.</p>
<div class="highlight"><pre><span></span><code>import matplotlib.pyplot as plt

plt.hist(df.prediction_probability)
plt.legend(title=&#39;Predictions Probability Histogram&#39;)
plt.show()
</code></pre></div>
<p><div style="text-align:center"><img src="../assets/Openscale/download.svg" alt="drawing" width=70%/></div></p>
</li>
</ol>
<h3 id="evaluating-model">Evaluating Model</h3>
<p>On the main <code>Insights Dashboard</code> when click on our deployment, we can evaluate  or model by clicking on the <code>Actions</code> button on the top-right and then <code>Evaluate now</code> in dropdown, where we can import a test dataset by either directly uploading a <code>.csv</code> file or by using dataset or database stored in the IBM COS.</p>
<div style="text-align:center"><img src="../assets/Openscale/Capture13.PNG" alt="drawing" width=60%/></div>

<p>After that, the metrics we defined for the monitors will be used to generate reports depicting our model's performance.</p>
<div style="text-align:center"><img src="../assets/Openscale/Capture15.PNG" alt="reports" width=60%/></div>

<h3 id="explaining-predictions">Explaining Predictions</h3>
<p>Again, in the <code>Transactions</code> page, we can click on the <code>Explain</code> button, in the following page we can observe each features' relative weight indicating how strongly they influenced the model’s predicted outcome.</p>
<p><a href="../assets/Openscale/Capture11.PNG"><img alt="" src="../assets/Openscale/Capture11.PNG" /></a></p>
<p>In the <code>Inspect</code> tab, there is a table displaying the values each  feature would have to have to alter the prediction result, here we can also change the values by hand to see what the outcome would be.</p>
<p><a href="../assets/Openscale/Capture12.PNG"><img alt="" src="../assets/Openscale/Capture12.PNG" /></a></p>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.extend"], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
        <script src="../../ASCII_cinema/asciinema-player.js"></script>
      
        <script src="../../_js/extra_js.js"></script>
      
    
  </body>
</html>