
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Repositório com documentações e materiais da Khipo">
      
      
        <meta name="author" content="Arthur Olga, Filipe Borba">
      
      
        <link rel="canonical" href="https://mb-data.github.io/old/CICD/cml_testing/">
      
      <link rel="icon" href="../../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>Continuous Integration with CML and Github Actions - Khipo Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../ASCII_cinema/asciinema-player.css">
    
      <link rel="stylesheet" href="../../../_css/extra_css.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="orange">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#continuous-integration-with-cml-and-github-actions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Khipo Docs" class="md-header__button md-logo" aria-label="Khipo Docs" data-md-component="logo">
      
  <img src="https://khipo.com.br/wp-content/uploads/2019/09/khipologo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Khipo Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Continuous Integration with CML and Github Actions
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M9.598 1.591a.75.75 0 0 1 .785-.175 7 7 0 1 1-8.967 8.967.75.75 0 0 1 .961-.96 5.5 5.5 0 0 0 7.046-7.046.75.75 0 0 1 .175-.786zm1.616 1.945a7 7 0 0 1-7.678 7.678 5.5 5.5 0 1 0 7.678-7.678z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 10.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5zM8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0V.75A.75.75 0 0 1 8 0zm0 13a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 8 13zM2.343 2.343a.75.75 0 0 1 1.061 0l1.06 1.061a.75.75 0 0 1-1.06 1.06l-1.06-1.06a.75.75 0 0 1 0-1.06zm9.193 9.193a.75.75 0 0 1 1.06 0l1.061 1.06a.75.75 0 0 1-1.06 1.061l-1.061-1.06a.75.75 0 0 1 0-1.061zM16 8a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1 0-1.5h1.5A.75.75 0 0 1 16 8zM3 8a.75.75 0 0 1-.75.75H.75a.75.75 0 0 1 0-1.5h1.5A.75.75 0 0 1 3 8zm10.657-5.657a.75.75 0 0 1 0 1.061l-1.061 1.06a.75.75 0 1 1-1.06-1.06l1.06-1.06a.75.75 0 0 1 1.06 0zm-9.193 9.193a.75.75 0 0 1 0 1.06l-1.06 1.061a.75.75 0 1 1-1.061-1.06l1.06-1.061a.75.75 0 0 1 1.061 0z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mb-data/mb-data.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    khipo-docs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Khipo Docs" class="md-nav__button md-logo" aria-label="Khipo Docs" data-md-component="logo">
      
  <img src="https://khipo.com.br/wp-content/uploads/2019/09/khipologo.png" alt="logo">

    </a>
    Khipo Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mb-data/mb-data.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    khipo-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Testes de Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Testes de Software" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Testes de Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Testes/Vis%C3%A3o%20Geral/" class="md-nav__link">
        Visão Geral
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-cml" class="md-nav__link">
    What is CML?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-with-github-actions" class="md-nav__link">
    Testing With Github Actions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-test" class="md-nav__link">
    Pipeline Test
  </a>
  
    <nav class="md-nav" aria-label="Pipeline Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-credentials" class="md-nav__link">
    Configuring Credentials
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-train-and-evaluate-workflow" class="md-nav__link">
    Adding Train and Evaluate Workflow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/mb-data/mb-data.github.io/tree/main/docs/old/CICD/cml_testing.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="continuous-integration-with-cml-and-github-actions">Continuous Integration with CML and Github Actions</h1>
<h2 id="what-is-cml">What is CML?</h2>
<p>CML, which stands by Continuous Machine Learning, it's an open-source library focused on delivering CI/CD for machine learning projects. Its principles includes:
 GitFlow: Using Git workflow for managing experiments alongside DVC versioning data and models.
Auto reports for experiments: CML can generate reports in pull requests with metrics and plots helping the team to make informed and data-driven decisions
Technology Agnostics: Build pipelines with Github or Gitlab and run experiments with any cloud service.
Since we are using Github as our Git repository, Github Actions will be used to set up CML. Github Actions is managed by Github, so there is no need to worry about scale and operate the infrastructure just as other tools like Jenkins.</p>
<h2 id="testing-with-github-actions">Testing With Github Actions</h2>
<p>First, we will make sure our tests created at the <a href="/CICD/tests/">Testing with Pytest and Black</a> section are being executed every time that there is a new <em>push</em> to the repository on Github. This important in order to achieve redundancy in testing the project, and avoid making sure the code runs without errors on any environment and not just the developer's computer.</p>
<p>To do this is very simple. If you used cookiecutter you should already have a file named <strong>test_on_push.yaml</strong> at <code>.github/workflows/</code> folder. The content of the file should be:</p>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Python Package and Test</span><span class="w"></span>

<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">on</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">push</span><span class="p p-Indicator">]</span><span class="w"></span>

<span class="w">    </span><span class="nt">jobs</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span><span class="w"></span>
<span class="w">        </span><span class="nt">strategy</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">matrix</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">3.6</span><span class="p p-Indicator">]</span><span class="w"></span>

<span class="w">        </span><span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python ${{ matrix.python-version }}</span><span class="w"></span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v2</span><span class="w"></span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.python-version }}</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span><span class="w"></span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">python -m pip install --upgrade pip</span><span class="w"></span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">pip install pytest black</span><span class="w"></span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">if [ -f requirements.txt ]; then pip install -r requirements.txt; fi</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test with pytest</span><span class="w"></span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">pytest</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Python Black</span><span class="w"></span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">black . --check</span><span class="w"></span>
</code></pre></div>
<p>Now, we should take a look into those commands.</p>
<p><strong><em>Choosing when this action will run</em></strong>
<div class="highlight"><pre><span></span><code><span class="nt">on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">push</span><span class="p p-Indicator">]</span><span class="w"></span>
</code></pre></div>
Makes it run every time there is a push on the repository</p>
<p><strong><em>Setting up a Github Instance to run it</em></strong>
<div class="highlight"><pre><span></span><code><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span><span class="w"></span>
</code></pre></div>
Github will setup a free Ubuntu instance for us, using the latest official release.</p>
<p><strong><em>Chosing the right version of Python</em></strong>
<div class="highlight"><pre><span></span><code><span class="nt">matrix</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">3.6</span><span class="p p-Indicator">]</span><span class="w"></span>
</code></pre></div></p>
<p><strong><em>Installing test requirements</em></strong>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">python -m pip install --upgrade pip</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">pip install pytest black</span><span class="w"></span>
</code></pre></div></p>
<p><strong><em>Installing project requirements</em></strong>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">if [ -f requirements.txt ]; then pip install -r requirements.txt; fi</span><span class="w"></span>
</code></pre></div></p>
<p><strong><em>Running Pytest</em></strong>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test with pytest</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">run</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">    </span><span class="no">pytest</span><span class="w"></span>
</code></pre></div></p>
<p><strong><em>Running Black check</em></strong>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Python Black</span><span class="w"></span>
<span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">run</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">     </span><span class="no">black . --check</span><span class="w"></span>
</code></pre></div>
This checks that every Python file is formatted according to Black.</p>
<p>If all tests pass the commit pushed to the repository will receive a green check show it has no errors. </p>
<p><img alt="green check" src="../../assets/CICD/green_check.png" /></p>
<h2 id="pipeline-test">Pipeline Test</h2>
<p>After setting up our test on push, let's focus on reproducing our pipeline on push and generate an automated report in pull requests to compare the experiment with the model at the main branch.</p>
<h3 id="configuring-credentials">Configuring Credentials</h3>
<p>To reproduce our experiment pipeline, we need to start pulling our data versioned by DVC. On the other hand, Github Actions will execute our pipeline inside a container pre-configured by CML that doesn't have our IBM credentials to pull the data from IBM COS. So, to solve this, let's configure our IBM credentials in Github Secrets.</p>
<p>Github Secrets is a repository tool that encrypts credentials to be used as environment variables in the project.</p>
<ul>
<li>Go to the repository settings</li>
</ul>
<p><img alt="repo bar" src="../../assets/gitsecrets/repo_bar.png" /></p>
<ul>
<li>On the left menu, click on 'Secrets'</li>
</ul>
<p><img alt="repo settings menu" src="../../assets/gitsecrets/repo_settings_menu.png" /></p>
<ul>
<li>Click on 'New repository secret'</li>
</ul>
<p><img alt="repo add cred" src="../../assets/gitsecrets/repo_add_cred.png" /></p>
<ul>
<li>Add both <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code></li>
</ul>
<p><img alt="repo adding cred" src="../../assets/gitsecrets/repo_adding_cred.png" /></p>
<h3 id="adding-train-and-evaluate-workflow">Adding Train and Evaluate Workflow</h3>
<p>Just like we did at the <em>Testing Setup</em>, let's create a file named <strong>train_evaluate.yaml</strong> at the <code>.github/workflows/</code> folder, which content should be:</p>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">model-training-evaluate</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">on</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">push</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">jobs</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="nt">run</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ubuntu-latest</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">     </span><span class="nt">container</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker://dvcorg/cml-py3:latest</span><span class="w"></span>
<span class="w">     </span><span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Train</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">Evaluate</span><span class="nv"> </span><span class="s">model&#39;</span><span class="w"></span>
<span class="w">     </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bash</span><span class="w"></span>
<span class="w">     </span><span class="nt">env</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="nt">repo_token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span><span class="w"></span>
<span class="w">     </span><span class="nt">AWS_ACCESS_KEY_ID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.AWS_ACCESS_KEY_ID }}</span><span class="w"></span>
<span class="w">     </span><span class="nt">AWS_SECRET_ACCESS_KEY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.AWS_SECRET_ACCESS_KEY }}</span><span class="w"></span>
<span class="w">     </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">     </span><span class="c1"># Install requirements</span><span class="w"></span>
<span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">pip install -r requirements.txt</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Pull data &amp; run-cache from IBM COS and reproduce pipeline</span><span class="w"></span>
<span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">dvc pull --run-cache</span><span class="w"></span>
<span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">dvc repro</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Report metrics</span><span class="w"></span>
<span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;## Metrics&quot; &gt;&gt; report.md</span><span class="w"></span>
<span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">git fetch --prune</span><span class="w"></span>
<span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">dvc metrics diff master --show-md &gt;&gt; report.md</span><span class="w"></span>

<span class="w">     </span><span class="c1"># Publish ROC Curve and </span><span class="w"></span>
<span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">echo -e &quot;## Plots\n### ROC Curve&quot; &gt;&gt; report.md</span><span class="w"></span>
<span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">cml-publish ./results/roc_curve.png --md &gt;&gt; report.md</span><span class="w"></span>
<span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">echo -e &quot;\n### Precision and Recall Curve&quot; &gt;&gt; report.md</span><span class="w"></span>
<span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">cml-publish ./results/precision_recall_curve.png --md &gt;&gt; report.md</span><span class="w"></span>
<span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">cml-send-comment report.md</span><span class="w"></span>
</code></pre></div>
<p>Let's dig into each command:</p>
<p><strong><em>Setting up a CML pre-configured container</em></strong>
<div class="highlight"><pre><span></span><code><span class="nt">container</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker://dvcorg/cml-py3:latest</span><span class="w"></span>
</code></pre></div></p>
<p><strong><em>Setting up environment credentials for IBM COS</em></strong>
<div class="highlight"><pre><span></span><code><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="nt">repo_token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span><span class="w"> </span>
<span class="nt">AWS_ACCESS_KEY_ID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.AWS_ACCESS_KEY_ID }}</span><span class="w"></span>
<span class="nt">AWS_SECRET_ACCESS_KEY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.AWS_SECRET_ACCESS_KEY}}</span><span class="w"></span>
</code></pre></div></p>
<p><strong><em>Installing requirements</em></strong>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">pip install -r requirements.txt</span><span class="w"></span>
</code></pre></div></p>
<p><strong><em>Pull the versioned data and reproduce the full pipeline of training and evaluation</em></strong>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">dvc pull --run-cache</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">dvc repro</span><span class="w"></span>
</code></pre></div></p>
<p><strong><em>Formatting report section tittles</em></strong>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">echo &quot;## Metrics&quot; &gt;&gt; report.md</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">echo -e &quot;## Plots\n### ROC Curve&quot; &gt;&gt; report.md</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">echo -e &quot;\n### Precision and Recall Curve&quot; &gt;&gt; report.md</span><span class="w"></span>
</code></pre></div></p>
<p><strong><em>Comparing metrics and publishing it to the report</em></strong>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">dvc metrics diff master --show-md &gt;&gt; report.md</span><span class="w"></span>
</code></pre></div></p>
<p><strong><em>Publishing figures from the experiment to the report</em></strong>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">cml-publish ./results/roc_curve.png --md &gt;&gt; report.md</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">cml-publish ./results/precision_recall_curve.png --md &gt;&gt; report.md</span><span class="w"></span>
</code></pre></div></p>
<p><strong><em>Return the final report formatted as a comment on the Commit or Pull Request</em></strong>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">cml-send-comment report.md</span><span class="w"></span>
</code></pre></div></p>
<p>The Report should look like the following:
<img alt="report" src="../../assets/CICD/Capture.PNG" />(.zoom)</p>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.extend"], "search": "../../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
        <script src="../../../ASCII_cinema/asciinema-player.js"></script>
      
        <script src="../../../_js/extra_js.js"></script>
      
    
  </body>
</html>